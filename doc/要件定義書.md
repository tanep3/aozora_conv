
# 要件定義書

## 1. はじめに

### 1.1 目的

本要件定義書は、aozora_conv アプリケーションの機能要件および非機能要件を明確にし、開発チームおよび関係者間で共通理解を図ることを目的とする。

### 1.2 背景

青空文庫形式のテキストファイルを効率的に処理し、読みやすいサイズに分割するツールの需要が高まっている。aozora_conv は、ユーザーが指定した読書速度および時間に基づいてテキストファイルを分割し、管理しやすい形で出力することを目的とする。

## 2. システム概要

aozora_conv は、青空文庫形式のテキストファイルを入力として受け取り、制御記号を削除し、作品名および著者名を抽出し、指定された読書速度および時間に基づいてテキストを分割して出力するシェルスクリプトである。

## 3. 機能要件

### 3.1 入力ファイルの指定

- ユーザーは -i または --input オプションを使用して、処理対象の入力ファイルを指定できる。
- 複数の入力ファイルを指定可能とする。
- 標準入力からの入力もサポートする。

### 3.2 出力ファイルの指定

- ユーザーは -o または --output オプションを使用して、出力ファイルのベース名を指定できる。
- -o オプションが指定されている場合、指定されたベース名に基づき、分割されたファイルにナンバリングを付与して出力する（例：text_001.txt, text_002.txt）。
- -o オプションが指定されていない場合、標準出力に1本のファイルを出力する。

### 3.3 テキストの分割機能

- ユーザーは -s または --speed オプションで読書スピード（1分間あたりの文字数）を指定できる。デフォルトは300文字/分。
- ユーザーは -t または --time オプションで分割時間（分単位）を指定できる。デフォルトは20分。
- 指定された読書スピードと時間に基づき、テキストを適切な文字数ごとに分割する。
- 分割の切れ目は、指定文字数に達した際に最初に現れる改行位置で行う。
- 指定時間に満たない最後の部分も必ず出力する。

### 3.4 制御記号の削除

以下の制御記号および注釈を削除する：
- ｜
- 《》
- ［＃...］
- ｛｝
- 〚〛
- 〔〕
- ／＼
- ／"＼
- 「」で囲まれた部分は削除せずに保持する。

### 3.5 文字コードの変換

- 入力ファイルの文字コードを自動的に検出し、UTF-8に変換する。
- 変換後の文字コードを標準エラー出力に出力する。

### 3.6 エラーハンドリング

- ユーザーが存在しないファイルを指定した場合、エラーメッセージを標準エラー出力に表示し、処理を中断する。
- -s または -t オプションを -o オプションなしで使用した場合、エラーメッセージを表示し処理を中断する。

### 3.7 処理完了後の情報出力

処理が完了した際に、総文字数および推定読書時間を標準エラー出力に表示する。

## 4. 非機能要件

### 4.1 性能

大規模なテキストファイルでも効率的に処理できるよう、最適化されたアルゴリズムを使用する。

### 4.2 信頼性

入力ファイルの文字コードを正確に検出・変換し、データの損失を防ぐ。

### 4.3 ユーザビリティ

シンプルなコマンドラインインターフェースを提供し、ユーザーが直感的に操作できるようにする。  
明確なヘルプメッセージを提供し、ユーザーがオプションの使用方法を理解できるようにする。

### 4.4 保守性

コードをモジュール化し、将来的な機能追加や修正が容易に行えるようにする。

## 5. 制約条件

- スクリプトはPOSIX互換のシェル環境で動作すること。
- 必要な外部ツール（nkf, sed, grep, gawk, mktemp, tr, head, sort, uniq, wc）がインストールされていること。

## 6. 用語の定義

- 青空文庫形式: 日本のオンライン電子図書館「青空文庫」で使用されるテキストファイルの形式。
- 制御記号: テキスト内で特定の機能を持つ特殊な記号やパターン（例：｜, 《》）。
